<!DOCTYPE html>

<html>
<head>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="css/tab_bar_overview_overview_style.css" media="screen" />
<title>Spartan Assault</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
</head>
<body>
	<div id="container"></div>
	<div id="magic_div">
		<script type="text/javascript">
			xmlhttp = new XMLHttpRequest();
			xmlhttp.open("GET","http://localhost:3000/overview", true);
			xmlhttp.onreadystatechange=function(){
				if (xmlhttp.readyState==4 && xmlhttp.status==200){
					var json_text = xmlhttp.responseText;
					
					var json_obj = JSON.parse(json_text);
					var myUsername = json_obj.username;
					
					var snippet = "<div id=\"title\">"+myUsername+"<\/div>";
					$(function() {
						$('#title').replaceWith($(snippet));
					});
					
					var gender = json_obj.gender;
					snippet = "<div id=\"profile_picture\" style=\"background-image:url('assets/gladiator_"+gender+".png')\"><\/div>";
					$(function() {
						$('#profile_picture').replaceWith($(snippet));
					});
					
					snippet = "<div id=\"stats\"> <p> Strength: " + json_obj.strength
										  + "<\/p> <p> Agility: " + json_obj.agility
										  + "<\/p> <p> Stamina: " + json_obj.stamina
										  + "<\/p> <p> Charisma: " + json_obj.charisma
										  + "<\/div>";
					$(function() {
						$('#stats').replaceWith($(snippet));
					});
					
					var helm = json_obj.helmet;
					snippet = "<div id=\"helmet\" style=\"background-image: url('assets/items/helm/"+helm+".png'); background-size: contain; background-repeat : no-repeat; background-position: center center\"><\/div>";
					$(function() {
						$('#helmet').replaceWith($(snippet));
					});
					
					var chest = json_obj.chest;
					snippet = "<div id=\"chest\" style=\"background-image: url('assets/items/chest/"+chest+".png'); background-size: contain; background-repeat : no-repeat; background-position: center center\"><\/div>";
					$(function() {
						$('#chest').replaceWith($(snippet));
					});
					
					var gloves = json_obj.gloves;
					snippet = "<div id=\"gloves\" style=\"background-image: url('assets/items/gloves/"+gloves+".png'); background-size: contain; background-repeat : no-repeat; background-position: center center\"><\/div>";
					$(function() {
						$('#gloves').replaceWith($(snippet));
					});
					
					var boots = json_obj.boots;
					snippet = "<div id=\"boots\" style=\"background-image: url('assets/items/boots/"+boots+".png'); background-size: contain; background-repeat : no-repeat; background-position: center center\"><\/div>";
					$(function() {
						$('#boots').replaceWith($(snippet));
					});
					
					var shield = json_obj.shield;
					snippet = "<div id=\"shield\" style=\"background-image: url('assets/items/shield/"+shield+".png'); background-size: contain; background-repeat : no-repeat; background-position: center center\"><\/div>";
					$(function() {
						$('#shield').replaceWith($(snippet));
					});
					
					var weapon = json_obj.weapon;
					snippet = "<div id=\"weapon\" style=\"background-image: url('assets/items/weapon/"+weapon+".png'); background-size: contain; background-repeat : no-repeat; background-position: center center\"><\/div>";
					$(function() {
						$('#weapon').replaceWith($(snippet));
					});
					
					snippet = "<div id=\"inventory1\" style=\"background-image: url('assets/items/"+json_obj.inventories[0].type+"/"+json_obj.inventories[0].name+".png'); background-repeat : no-repeat; background-position: center center\"><\/div>";
					$(function() {
						$('#inventory1').replaceWith($(snippet));
					});
				}
			}
			xmlhttp.send();
	
		</script>

		<div id="title"></div>
		<div id="profile_picture"></div>
		<div id="stats"></div>
		<div id="equipment"></div>
		
		<div id="inventory1">
			<div id="test" class="draggable drag-drop" style="z-index:100; position:relative; background-color:white; width:20px; height:20px;"></div>	
		</div>
		
		<div id="inventory2"></div>
		<div id="inventory3"></div>
		<div id="inventory4"></div>
		<div id="inventory5"></div>
		
		<div id="inventory_description"></div>
		<div id="inventory_menu_bar"></div>
		<div id="inventory_menu_bar_button1" class="alignCenter">I</div>
		<div id="inventory_menu_bar_button2" class="alignCenter">II</div>
		<div id="inventory_menu_bar_button3" class="alignCenter">III</div>
		<div id="inventory_menu_bar_button4" class="alignCenter">IV</div>
		<div id="inventory_menu_bar_button5" class="alignCenter">V</div>
		
		<div id="helmet"></div>
		<div id="weapon"></div>
		<div id="chest"></div>
		<div id="shield"></div>
		<div id="gloves"></div>
		<div id="boots"></div>
		<div id="magic1"></div>
		<div id="magic2"></div>
		<div id="magic3"></div>
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script src="/node_modules/interact.js/interact.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/interact.js/1.2.4/interact.min.js"></script>
	
	<script type="text/javascript" language="javascript">

	$(document).ready(function() {
			
			$("#inventory1").show();
			$("#inventory2").hide();
			$("#inventory3").hide();
			$("#inventory4").hide();
			$("#inventory5").hide();
			
			$("#inventory_menu_bar_button1").click(function(event){
				$("#inventory1").show();
				$("#inventory2").hide();
				$("#inventory3").hide();
				$("#inventory4").hide();
				$("#inventory5").hide();
			});
			
			$("#inventory_menu_bar_button2").click(function(event){
				$("#inventory1").hide();
				$("#inventory2").show();
				$("#inventory3").hide();
				$("#inventory4").hide();
				$("#inventory5").hide();
			});
			
			$("#inventory_menu_bar_button3").click(function(event){
				$("#inventory1").hide();
				$("#inventory2").hide();
				$("#inventory3").show();
				$("#inventory4").hide();
				$("#inventory5").hide();
			});
			
			$("#inventory_menu_bar_button4").click(function(event){
				$("#inventory1").hide();
				$("#inventory2").hide();
				$("#inventory3").hide();
				$("#inventory4").show();
				$("#inventory5").hide();
			});
			
			$("#inventory_menu_bar_button5").click(function(event){
				$("#inventory1").hide();
				$("#inventory2").hide();
				$("#inventory3").hide();
				$("#inventory4").hide();
				$("#inventory5").show();
			});
			
	interact('.draggable')
	    .draggable({
	        onmove: function (event) {
	            var target = event.target,
	                x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
	                y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
	
	            target.style.webkitTransform =
	            target.style.transform =
	                'translate(' + x + 'px, ' + y + 'px)';
	
	            target.setAttribute('data-x', x);
	            target.setAttribute('data-y', y);
	        },
	        onend: function (event) {
			
	            var dropRect = interact.getElementRect(event.target);
		        var stanga = dropRect.left;
				var sus = dropRect.top;
				
				var chestPosition=814;
				var pozitieFinalaStanga=chestPosition-stanga;
				
				var chestPositionTop=178;
				var pozitieFinalaSus=chestPositionTop-sus;

				$("#test").css({"position":"absolute", "left":pozitieFinalaStanga, "top":pozitieFinalaSus, "z-index":"5"});
				$("#test").removeClass();
				
				
				var textEl = event.target.querySelector('p');
	            
	            textEl && (textEl.textContent =
	                'moved a distance of '
	                + (Math.sqrt(event.dx * event.dx +
	                             event.dy * event.dy)|0) + 'px');
	        }
	    })
	    .inertia(true)
	    .restrict({
	        drag: "self",
	        endOnly: true,
	        elementRect: { top: 20, left: 20, bottom: 0, right: 0 }
	    });
	    
	interact('.draggable').snap({
	      mode: 'anchor',
	      anchors: [],
	      range: Infinity,
	      elementOrigin: { x: 0.5, y: 0.5 },
	      endOnly: true
	});
    
	interact("#chest").dropzone({
	    accept: "#test",
	    overlap: 1,
	    ondropactivate: function (event) {
	        event.target.classList.add('drop-active');
	    },
	    ondragenter: function (event) {

	        var draggableElement = event.relatedTarget,
	            dropzoneElement = event.target;
	        dropzoneElement.classList.add('drop-target');
	        draggableElement.classList.add('can-drop');
		    var dropRect = interact.getElementRect(event.target),
		        dropCenter = {
		          x: dropRect.left + dropRect.width  / 2,
		          y: dropRect.top  + dropRect.height / 2
		        };
		
		    event.draggable.snap({
		      anchors: [ dropCenter ]
		    });
	    },
	    ondragleave: function (event) {
	        var draggableElement = event.relatedTarget,
	            dropzoneElement = event.target;
	        event.target.classList.remove('drop-target');
	        event.relatedTarget.classList.remove('can-drop');	
			event.draggable.snap(false);
	    },
	    ondrop: function (event) {
	    },
	    ondropdeactivate: function (event) {
	        event.target.classList.remove('drop-active');
	        event.target.classList.remove('drop-target');
	    }
	})
			
         });
		 
    </script>
	
</body>
</html>